<!DOCTYPE html>
<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js"></script>
    <title>Soil Moisture Monitoring and Recommendations</title>
    <script>
        new Chart(
            document.getElementById('moisture').getContext('2d'),
            {
                type: 'line',
                data: {
                    labels: [].map(row => row.created_at),
                    datasets: [
                        {
                            label: 'Moisture Level (%)',
                            data: [].map(row => row.level * 100)
                        }
                    ]
                }
            }
        );
        const getMoistureData = () => {
            var data = fetch('http://plantsaver.peppersalt.info:5000/moisture', {
                method: 'GET',
                mode: 'cors',
                headers: {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*'
                }
            }).then(function (response) {
                return response.json();
            }).then(function (data) {
                chart.data.datasets[0].data = data.moisture_levels.map(row => row.level * 100);
                chart.data.labels = data.moisture_levels.map(row => row.created_at);
                chart.update();
            }).catch(function (err) {
                console.log(err);
            });
        }
        window.setInterval(getMoistureData, 1000);
    </script>
</head>

<body>
    <h1>Soil Moisture Monitoring and Recommendations</h1>
    <p>This is a basic HTML template.</p>
    <div style="width: 800px;"><canvas id="moisture"></canvas></div>
</body>

</html>